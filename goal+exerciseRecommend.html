//finished
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness App</title>
    <style>
        .hidden { display: none; }
        .main-page-hidden { display: block; }
        .progress-bar {
            background-color: #e0e0e0;
            border-radius: 5px;
        }
        .progress {
            background-color: #76c7c0;
            height: 20px;
        }
        .video-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border-radius: 5px;
            padding: 10px;
            width: calc(33.33% - 10px);
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1>Health and Fitness tracking app - GoalSystem</h1>
    <div class="hidden" id="missionList">
        MissionList :
        <div>Mission 1: xp: 20<button id="mission1" onclick="completeTask('mission1', 20)">Complete</button></div>
        <div>Mission 2: xp: 20<button id="mission2" onclick="completeTask('mission2', 20)">Complete</button></div>
        <div>Mission 3: xp: 30<button id="mission3" onclick="completeTask('mission3', 30)">Complete</button></div>
    </div>
    
    <h2>Goal setting</h2>
        <div>
            <h3>Day's step goal</h3>
            <input type="number" id="stepGoal" placeholder="Enter step goal per day">
            <button class="button" onclick="setStepGoal()">Set goal</button>
            <p>当前目标：<span id="currentStepGoal">0</span> steps</p>
            <div class="progress-bar">
            <div class="progress" id="stepProgress" style="width: 0%;">0%</div>
        </div>
        <div>
            <h3>Week's exercise goal</h3>
            <input type="number" id="exerciseGoal" placeholder="Enter exercise time per week (hour)">
            <button class="button" onclick="setExerciseGoal()">Set goal</button>
            <p>当前目标：<span id="currentExerciseGoal">0</span> hours</p>
            <div class="progress-bar">
                <div class="progress" id="exerciseProgress" style="width: 0%;">0%</div>
            </div>
        </div>
        <h2>Progress tracking</h2>
        <div>
            <h3>Update tracking</h3>
            <input type="number" id="stepsTaken" placeholder="Enter today's finished steps">
            <button class="button" onclick="updateSteps()">Update steps</button>
            <input type="number" id="exerciseDone" placeholder="Enter week's exercise time(hour)">
            <button class="button" onclick="updateExercise()">Update exercise hour</button>
        </div>
        
    <button id="showMissionList">Mission list<button id="leave">X</button></button>
    <div class="main-page-hidden" id="main-page">
        <h2>Main page</h2>
        <p>Level: <span id="level-display">0</span></p>
        <p>XP: <span id="xp-display">0</span></p>
        <p>Next level XP: <span id="nextLevelXP-display">100</span></p>
    </div>
    <h2>Exercise recommendation</h2>
    <div>
        <h3>Recommended exercise</h3>
        <button onclick="recommendExercise()">Get recommendation</button>
        <button onclick="leaveRecommend()">X</button>
        <div class="video-container" id="videoContainer"></div>
    </div>
    <button id="clearData">Clear Data</button>
    <script>
        let stepGoal = localStorage.getItem('stepGoal') ? parseInt(localStorage.getItem('stepGoal')) : 0;
        let exerciseGoal = localStorage.getItem('exerciseGoal') ? parseInt(localStorage.getItem('exerciseGoal')) : 0;
        let stepsTaken = localStorage.getItem('stepsTaken') ? parseInt(localStorage.getItem('stepsTaken')) : 0;
        let exerciseDone = localStorage.getItem('exerciseDone') ? parseInt(localStorage.getItem('exerciseDone')) : 0;
        let level = parseInt(localStorage.getItem('level')) || 0;
        let xp = parseInt(localStorage.getItem('xp')) || 0;
        let nextLevelXP = parseInt(localStorage.getItem('nextLevelXP')) || 100;
        const showMissionList = document.getElementById('showMissionList');
        const missionList = document.getElementById('missionList');
        const leave = document.getElementById('leave');
        const mainPage = document.getElementById('main-page');
        const xpDisplay = document.getElementById('xp-display');
        const levelDisplay = document.getElementById('level-display');
        const nextLevelXP_Display = document.getElementById('nextLevelXP-display');
        const clearData = document.getElementById('clearData');

        function setStepGoal() {
            stepGoal = document.getElementById('stepGoal').value;
            localStorage.setItem('stepGoal', stepGoal);
            document.getElementById('currentStepGoal').innerText = stepGoal
            updateProgress()
        }

        function setExerciseGoal() {
            exerciseGoal = document.getElementById('exerciseGoal').value;
            localStorage.setItem('exerciseGoal', exerciseGoal);
            document.getElementById('currentExerciseGoal').innerText = exerciseGoal;
            updateProgress()
        }

        function updateSteps() {
           stepsTaken = document.getElementById('stepsTaken').value;
           localStorage.setItem('stepsTaken', stepsTaken);  
           updateProgress()
        }

        function updateExercise() {
           exerciseDone = document.getElementById('exerciseDone').value;
           localStorage.setItem('exerciseDone', exerciseDone);
           updateProgress()
        }

        function updateProgress() {
            if(stepGoal > 0){
                const stepProgress = (stepsTaken / stepGoal) * 100;
                document.getElementById('stepProgress').style.width = stepProgress + '%';
                document.getElementById('stepProgress').innerText = Math.round(stepProgress) + '%';
            }
            if(exerciseGoal > 0){
                const exerciseProgress = (exerciseDone / exerciseGoal) * 100;
                document.getElementById('exerciseProgress').style.width = exerciseProgress + '%';
                document.getElementById('exerciseProgress').innerText = Math.round(exerciseProgress) + '%';
            }
        }

        showMissionList.addEventListener('click', function() {
            missionList.classList.remove('hidden');
            mainPage.style.display = 'none';

        });
        leave.addEventListener('click', function() {
            missionList.classList.add('hidden');
            mainPage.style.display = 'block';
        });
        clearData.addEventListener('click', function() {
            localStorage.clear();
            level = 0;
            xp = 0;
            nextLevelXP = 100;
            updateDisplay();
            resetTasks();
            alert('All data has been cleared.');
        });
        function completeTask(missionId, xpReward) {
            const button = document.getElementById(missionId);
            if (button.disabled) return; 
            button.disabled = true;
            button.textContent = "Completed";
            localStorage.setItem(missionId + "_completed", "true");
            xp += xpReward;
            localStorage.setItem('xp', xp);
            updateDisplay();
            checkLevelUP();
        }
        function checkLevelUP() {
            if (xp >= nextLevelXP) {
                level++;
                xp = xp - nextLevelXP;
                nextLevelXP = Math.round(nextLevelXP * 1.5);
                alert(`Level up! You are now level ${level}.`);
                localStorage.setItem('level', level);
                localStorage.setItem('nextLevelXP', nextLevelXP);
                updateDisplay();
            }
        }
        function updateDisplay() {
            xpDisplay.textContent = xp;
            levelDisplay.textContent = level;
            nextLevelXP_Display.textContent = nextLevelXP;
        }
        function resetTasks() {
            const missions = ['mission1', 'mission2', 'mission3'];
            missions.forEach(missionId => {
                const button = document.getElementId(missionId);
                button.disabled = false;
                button.textContent = "Complete";
            });
        }
        function initializeTasks() {
            const currentDate = new Date().toISOString().split("T")[0];
            const lastUpdateDate = localStorage.getItem("last_update_date");
            if (lastUpdateDate !== currentDate) {
                localStorage.removeItem("mission1_completed");
                localStorage.removeItem("mission2_completed");
                localStorage.removeItem("mission3_completed");
                localStorage.setItem("last_update_date", currentDate);
            }
            const missions = ['mission1', 'mission2', 'mission3'];
            missions.forEach(missionId => {
                const completed = localStorage.getItem(missionId + "_completed") === "true";
                const button = document.getElementById(missionId);
                if (completed) {
                    button.disabled = true;
                    button.textContent = "Completed";
                }
            });
        }
        function recommendExercise() {
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = ""; 

            const categories = Object.keys(exerciseVideos);
            categories.forEach(category => {
                const videos = exerciseVideos[category];
                const randomIndex = Math.floor(Math.random() * videos.length);
                const video = videos[randomIndex];

                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                videoCard.innerHTML = `
                    <h4>${video.title}</h4>
                    <iframe src="${video.url}" allowfullscreen></iframe>
                `;
                videoContainer.appendChild(videoCard);
            });
        }

        const exerciseVideos = {
            cardio: [
                { title: "高强度间歇训练 (HIIT)", url: "https://www.youtube.com/embed/UBMk30rjy0o" },
                { title: "有氧舞蹈", url: "https://www.youtube.com/embed/d3LPrhI0v-w" },
                { title: "燃脂跑步训练", url: "https://www.youtube.com/embed/6vY9QP1FdHc" },
                { title: "跳绳有氧运动", url: "https://www.youtube.com/embed/1BZM2Vre5oc" },
                { title: "全身有氧训练", url: "https://www.youtube.com/embed/3sEeVJEXTfY" }
            ],
            strength: [
                { title: "全身力量训练", url: "https://www.youtube.com/embed/3p8EBPVZ2Iw" },
                { title: "哑铃训练", url: "https://www.youtube.com/embed/0JfYxMRsUCQ" },
                { title: "核心力量训练", url: "https://www.youtube.com/embed/2pLT-olgUJs" },
                { title: "上肢力量训练", url: "https://www.youtube.com/embed/4Y2ZdHCOXok" },
                { title: "下肢力量训练", url: "https://www.youtube.com/embed/7j4hDxFG4eU" }
            ],
            yoga: [
                { title: "初学者瑜伽", url: "https://www.youtube.com/embed/v7AYKMP6rOE" },
                { title: "放松瑜伽", url: "https://www.youtube.com/embed/4pKly2JojMw" },
                { title: "晨间瑜伽", url: "https://www.youtube.com/embed/8LwYyz6Zy10" },
                { title: "睡前瑜伽", url: "https://www.youtube.com/embed/9AjkUyX0rVw" },
                { title: "流瑜伽", url: "https://www.youtube.com/embed/6zWz2Zx9z4A" }
            ]
        };

        function leaveRecommend() {
        videoContainer.innerHTML = "";
    }

    document.getElementById('recommendExercise').addEventListener('click', recommendExercise);
    document.getElementById('leaveRecommend').addEventListener('click', leaveRecommend);

        window.onload = function () {
            document.getElementById('currentStepGoal').innerText = stepGoal;
            document.getElementById('currentExerciseGoal').innerText = exerciseGoal;
            document.getElementById('stepsTaken').value = stepsTaken;
            document.getElementById('exerciseDone').value = exerciseDone;
            updateProgress();
        };

        window.onload = function() {
            updateDisplay();
            initializeTasks();
            leaveRecommend();
        };
    </script>
</body>
</html>
